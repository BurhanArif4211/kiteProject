<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet"
            href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
            integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm"
            crossorigin="anonymous">
        <link rel="stylesheet"
            href="https://use.fontawesome.com/releases/v5.3.1/css/all.css"
            integrity="sha384-mzrmE5qonljUremFsqc01SB46JvROS7bZs3IO2EmfFsd15uHvIt+Y8vEf7N7fWAU"
            crossorigin="anonymous">

        <!-- This is added justfor message boxes  -->
        <link href="https://fonts.googleapis.com/icon?family=Material+Icons"
            rel="stylesheet">
        <script
            src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
        <title>User Kite </title>
        <style>

            /*GPT */
            .profile-picture-container {
                position: relative;
                display: inline-block;
            }
        
            .overlay {
                position: absolute;
                z-index: 3;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.5);
                display: flex;
                justify-content: center;
                align-items: center;
                opacity: 0;
                transition: opacity 0.3s;
                cursor: pointer;
            }
        
            .camera-icon {
                color: #fff;
                font-size: 24px;
                cursor: pointer;
            }
        
            .overlay:hover  {
                opacity: 1;
            }
            
            
            /*end*/
        .btn-logout{
            position: absolute;
            top:4.44%;
            right: 13.33%;
        }
    </style>
        <body>
            <form method="POST" action="/api/logout">
                {% csrf_token %}

                <button class="btn btn-primary btn-logout" type="submit"><i
                        class="fas fa-user-plus"></i>logout</button>
            </form>

            <section class="h-600 ">
                <div class="container py-5 h-600">
                    <div
                        class="row d-flex justify-content-center align-items-center h-100">
                        <div class="col col-lg-9 col-xl-11">
                            <div class="card">
                                <div
                                    class="rounded-top text-white d-flex flex-row"
                                    style="background-image: linear-gradient(to top right ,#4BBBAA, #F7B633,#FA4B16); height:200px;">
                                    <div class="ms-4 mt-5 d-flex flex-column"
                                        style="width: 150px;">
                                        <div class="position-relative">
                                            <!-- Profile picture -->
                                            <img
                                                src="{{ profile_info.pp_url }}"
                                                alt="user pp"
                                                class="img-fluid img-thumbnail mt-4 mb-2"
                                                style="width: 150px; z-index: 1"
                                                id="profile-picture"
                                            >
                                        
                                            <!-- Overlay for hover effect -->
                                            <div class="overlay" id="overlay">
                                                <form enctype="multipart/form-data" id="change-profile-pic" method="post" action="/api/uploaduserpic"> 
                                                    {%csrf_token%}
                                                <label for="pp-input" class="camera-icon">
                                                    <i class="fas fa-camera"></i>
                                                </label>
                                                <input name="pp" type="file" id="pp-input" style="display: none">
                                            </form>
                                            </div>
                                        </div>
                                        <button type="button"
                                            class="btn btn-outline-dark"
                                            data-mdb-ripple-color="dark"
                                            style="z-index: 1;">
                                            Edit profile
                                        </button>
                                    </div>
                                    <div class="ms-3" style="margin-top: 130px;">
                                        <h5>{{ user_claims.name }}</h5>
                                        <p>{{ profile_info.niche }}</p>
                                    </div>
                                </div>
                                <div class="p-4 text-black"
                                    style="background-color: #f8f9fa;">
                                    <div
                                        class="d-flex justify-content-end text-center py-1">
                                        <div>
                                            <p class="mb-1 h5">0</p>
                                            <p class="small text-muted mb-0">Photos</p>
                                        </div>
                                        <div class="px-3">
                                            <p class="mb-1 h5">0</p>
                                            <p class="small text-muted mb-0">Followers</p>
                                        </div>
                                        <div>
                                            <p class="mb-1 h5">0</p>
                                            <p class="small text-muted mb-0">Following</p>
                                        </div>
                                    </div>
                                </div>
                                <div id="post-grid-container"></div>

                                <script>
                                    // Fetch and load the post grid component asynchronously
                                    fetch('/api/loaduserposts')
                                        .then(response => response.text())
                                        .then(html => {
                                            document.getElementById('post-grid-container').innerHTML = html;
                                        });

                                    document.getElementById('overlay').addEventListener('click', function () {
                                            document.getElementById('pp-input').click();
                                        });
                                    // Handle file selection and upload
                                    document.getElementById('pp-input').addEventListener('change', function (event) {
                                        // Submit the form when a file is selected
                                        document.getElementById('change-profile-pic').submit();
                                    });
                                        
                                </script>
                            
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

        </body>
    </html>